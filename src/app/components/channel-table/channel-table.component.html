<div
    class="page-container"
    fxLayout="column"
    fxFlex="90"
    fxFlex.xs="96"
    fxFlex.lg="70"
    fxFlex.xl="60"
    fxFlexOffset="5"
    fxFlexOffset.xs="2"
    fxFlexOffset.xl="20"
    fxFlexOffset.lg="15"
>
    <app-page-header
        (added)="onOpenChannel()"
        (cleared)="clearFilter()"
        (filtered)="this.filter = $event; applyKeywordFilter()"
        (ordered)="changeOrder()"
        (sorted)="applyFilters($event)"
        [ascending]="ascending"
        [keyword]="filter"
        [showButton]="true"
        [sortingOptions]="sortingOptions"
        [sorting]="sorting"
        [total]="totalChannels"
        label="Channels"
    >
    </app-page-header>

    <mat-paginator
        class="mat-elevation-z1 page-paginator"
        fxLayout="row"
        fxLayoutAlign="end"
        [length]="totalChannels"
        [pageSize]="pageSize"
        [pageSizeOptions]="[10, 25, 50, 100]"
        (page)="onPageEvent($event)"
    >
    </mat-paginator>

    <div
        class="match-parent-height"
        fxLayout="column"
        fxLayoutAlign="center center"
        *ngIf="totalChannels == 0 && !(refreshing$ | async)"
    >
        <mat-icon color="primary">info</mat-icon>
        <h2 class="mat-title">No channels found!</h2>
    </div>

    <div
        *ngIf="totalChannels > 0"
        [@flyInOut]="'in'"
        class="token-transfer-button"
        fxLayout="row"
        fxLayoutAlign="end"
    >
        <button mat-raised-button color="accent" (click)="onPay()">
            <mat-icon>payment</mat-icon>
            {{ 'Send Tokens' | uppercase }}
        </button>
    </div>

    <div
        class="match-parent-height"
        fxLayout="column"
        fxLayoutAlign="center center"
        *ngIf="!filter && totalChannels == 0 && (refreshing$ | async)"
    >
        <mat-progress-spinner
            [diameter]="60"
            [color]="'primary'"
            [mode]="'indeterminate'"
        >
        </mat-progress-spinner>
    </div>

    <div
        class="page-list"
        fxLayout="column"
        fxLayoutGap="15px"
        *ngIf="totalChannels > 0"
    >
        <mat-card
            *ngFor="let channel of visibleChannels; trackBy: trackByFn"
            [id]="'channel_' + channel.channel_identifier"
            ngClass.gt-xs="card"
            ngClass.xs="card-mobile"
            [@flyInOut]="'in'"
        >
            <mat-card-content fxLayout="row" fxLayoutGap="15px">
                <div
                    fxLayout="column"
                    class="channel-id"
                    fxLayoutAlign="center"
                >
                    {{ channel.channel_identifier }}
                </div>

                <div fxLayout="column" fxFlex="0 0 4em" fxLayoutAlign="center">
                    <img
                        class="identicon no-margin"
                        [src]="identicon(channel)"
                        alt="Identicon of the partner address"
                    />
                </div>
                <div
                    class="can-shrink"
                    fxLayout="column"
                    fxFlex="1 1 100%"
                    fxLayoutAlign="center"
                    fxLayoutGap="2px"
                >
                    <div
                        fxLayout="row"
                        *ngIf="
                            addressLabel(channel.partner_address);
                            else partner_label
                        "
                        class="item-label truncate"
                    >
                        {{ addressLabel(channel.partner_address) }}
                    </div>

                    <ng-template #partner_label>
                        <div class="item-label" fxLayout="row">Partner</div>
                    </ng-template>
                    <div fxLayout="row" class="truncate item-info">
                        <span fxLayout="column" class="truncate address">{{
                            channel.partner_address
                        }}</span>
                        <span fxLayout="column">
                            <button
                                class="clipboard-button"
                                mat-icon-button
                                ngxClipboard
                                [cbContent]="channel.partner_address"
                            >
                                <mat-icon
                                    aria-label="Copy address to clipboard"
                                >
                                    content_copy
                                </mat-icon>
                            </button>
                        </span>
                    </div>

                    <div class="item-label" fxLayout="row">Balance</div>
                    <div class="item-info" fxLayout="row">
                        <span>{{
                            channel.balance
                                | decimal: channel.userToken.decimals
                        }}</span>
                        <sup
                            matTooltip="{{ channel.userToken | token }}"
                            matTooltipPosition="above"
                            class="token-symbol space gray"
                        >
                            {{ channel.userToken.symbol }}
                        </sup>
                    </div>
                    <div class="channel-status" fxLayout="row">
                        <span class="item-label">Status:</span>
                        <span class="light space">{{
                            channel.state | status
                        }}</span>
                    </div>
                </div>

                <div
                    fxLayout="column"
                    fxShow
                    fxHide.xs
                    fxFlex="0 0 5em"
                    fxLayoutAlign="start"
                >
                    <app-channel-actions
                        [channel]="channel"
                        (openCloseDialog)="onClose(channel)"
                        (openPayDialog)="onPay(channel)"
                        (openDepositDialog)="onDeposit(channel)"
                    ></app-channel-actions>
                </div>
                <div
                    fxLayout="column"
                    fxFlex="0 0 40px"
                    fxLayoutAlign="start end"
                >
                    <button
                        mat-icon-button
                        color="accent"
                        [matMenuTriggerFor]="menu"
                    >
                        <mat-icon>more_vert</mat-icon>
                    </button>
                    <mat-menu #menu="matMenu">
                        <button
                            mat-menu-item
                            [routerLink]="['/payments']"
                            [queryParams]="{
                                token_address: channel.token_address,
                                partner_address: channel.partner_address
                            }"
                        >
                            <span>Payment History</span>
                        </button>
                    </mat-menu>
                </div>
            </mat-card-content>

            <app-channel-actions
                fxHide
                fxShow.xs
                [channel]="channel"
                (openCloseDialog)="onClose(channel)"
                (openPayDialog)="onPay(channel)"
                (openDepositDialog)="onDeposit(channel)"
            ></app-channel-actions>
        </mat-card>
    </div>
</div>
